{% extends 'constructionapp/base.html' %}

{% block title %}Order History - BuildMart{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1>My Orders</h1>
        <nav class="breadcrumb">
            <a href="{% url 'home' %}">Home</a>
            <span>/</span>
            <a href="{% url 'dashboard' %}">Dashboard</a>
            <span>/</span>
            <span>Orders</span>
        </nav>
    </div>
</div>

<section class="orders-section">
    <div class="container">
        <div class="orders-layout">
            <!-- Sidebar -->
            <aside class="orders-sidebar">
                <div class="user-profile-card">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-info">
                        <h3>{{ user.get_full_name|default:user.username }}</h3>
                        <p>{{ user.email }}</p>
                    </div>
                </div>
                
                <nav class="dashboard-nav">
                    <a href="{% url 'dashboard' %}">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a href="{% url 'profile' %}">
                        <i class="fas fa-user-edit"></i> Edit Profile
                    </a>
                    <a href="{% url 'order_history' %}" class="active">
                        <i class="fas fa-box"></i> My Orders
                    </a>
                    <a href="{% url 'cart' %}">
                        <i class="fas fa-shopping-cart"></i> My Cart
                    </a>
                    <a href="{% url 'logout' %}">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </nav>
            </aside>
            
            <!-- Orders List -->
            <div class="orders-content">
                <div class="orders-header">
                    <h2>Order History</h2>
                    <p>Track and manage your orders</p>
                </div>
                
                {% if orders %}
                    <div class="orders-list">
                        {% for order in orders %}
                            <div class="order-card">
                                <div class="order-header">
                                    <div class="order-id">
                                        <span class="label">Order ID</span>
                                        <span class="value">#{{ order.order_number }}</span>
                                    </div>
                                    <div class="order-date">
                                        <span class="label">Date</span>
                                        <span class="value">{{ order.created_at|date:"d M Y, h:i A" }}</span>
                                    </div>
                                    <div class="order-status">
                                        <span class="status-badge status-{{ order.status|lower }}">{{ order.get_status_display }}</span>
                                    </div>
                                </div>
                                
                                <div class="order-items">
                                    {% for item in order.items.all %}
                                        <div class="order-item">
                                            <div class="item-image">
                                                {% if item.product.image %}
                                                    <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                                                {% else %}
                                                    <div class="no-image">
                                                        <i class="fas fa-image"></i>
                                                    </div>
                                                {% endif %}
                                            </div>
                                            <div class="item-details">
                                                <h4>{{ item.product.name }}</h4>
                                                <span class="item-qty">Qty: {{ item.quantity }} {{ item.product.unit }}</span>
                                            </div>
                                            <div class="item-price">₹{{ item.get_total_price }}</div>
                                        </div>
                                    {% endfor %}
                                </div>
                                
                                <div class="order-footer">
                                    <div class="order-total">
                                        <span class="label">Total</span>
                                        <span class="amount">₹{{ order.total_amount }}</span>
                                    </div>
                                    <div class="order-actions">
                                        <button class="btn btn-outline btn-sm">
                                            <i class="fas fa-eye"></i> View Details
                                        </button>
                                        {% if order.status == 'DELIVERED' %}
                                            <button class="btn btn-primary btn-sm">
                                                <i class="fas fa-redo"></i> Reorder
                                            </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-orders">
                        <div class="empty-icon">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <h3>No Orders Yet</h3>
                        <p>You haven't placed any orders yet. Start shopping to see your orders here.</p>
                        <a href="{% url 'product_list' %}" class="btn btn-primary btn-lg">
                            <i class="fas fa-store"></i> Browse Products
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}
